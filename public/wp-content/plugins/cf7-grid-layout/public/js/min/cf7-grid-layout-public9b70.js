!function(t){"use strict";var e=[],a=[],i={};t.fn.cf7sgWarning=function(e){var a=t(this);if(!a.is(":input"))return a;var i=t('<span class="cf7sg-validation-warning">'+e+'<span class="confirm-button">ok</span></span>');a.after(i)},t(document).ready(function(){t("form.wpcf7-form").on("click",".confirm-button",function(e){var a=t(e.target);a.is(".cf7sg-validation-warning .confirm-button")&&a.parent().remove()});var e=t("div.cf7-smart-grid.has-table form.wpcf7-form");e.length&&(t(".container.cf7-sg-table",e).each(function(){var e=t(this);if(e[0].hasAttribute("id")){var a=t('<input class="cf7sg-tracker-field" value="1" type="hidden">').attr("name",e.attr("id"));e.prepend(a)}var i=t(".row.cf7-sg-table",e),s="Add Row";switch(!0){case e[0].hasAttribute("data-button"):s=e.data("button");break;case i[0].hasAttribute("data-button"):s=i.data("button")}i.find(":input").each(function(){var e=t(this),a=e.attr("name");a.length>0&&e.addClass("cf7sg-"+a.replace("[]",""))});var n=e.next(".container.cf7-sg-table-footer");n.length>0?(n.detach(),e.after(n),n.after('<div class="cf7-sg-table-button"><a href="javascript:void(0);" class="ui-button">'+s+"</a></div>")):e.after('<div class="cf7-sg-table-button"><a href="javascript:void(0);" class="ui-button">'+s+"</a></div>"),i.attr("data-row","0"),(i=i.clone().addClass("cf7-sg-cloned-table-row")).attr("data-row","-1"),e.append(i.hide()),t(":input",i).prop("disabled",!0),i.append('<span class="row-control"><span class="dashicons dashicons-no-alt"></span></span>'),e.trigger("sgTableReady")}),e.click(".container",function(e){var a=t(e.target);if(a.is("div.cf7-sg-table-button a")){if((a=a.parent()).hasClass("disabled"))return!1;(i=a.prev(".container")).is(".cf7-sg-table-footer")&&(i=i.prev(".container")),i.cf7sgCloneRow()}else if(a.is(".cf7-sg-table .row-control .dashicons")){var i=a.closest(".container");a.closest(".row.cf7-sg-table").remove();var s=i.children(".row.cf7-sg-table").not(".cf7-sg-cloned-table-row").length;i.trigger("sgRowDeleted");var n=i.children(".cf7sg-tracker-field");n.length&&n.val(s)}}));var a=t("div.cf7-smart-grid.has-validation form.wpcf7-form");a.length&&(t('input[type="number"][class*="sgv-"]',a).each(function(){var e=t(this),a=e.attr("value");e.data("current",a)}),a.change('input[type="number"]',function(e){if(t(e.target).is('input[type="number"]')){var a=t(e.target),i=a.data("current"),s=!1;switch(!0){case 0==a.val()&&a.is(".sgv-no-zero"):a.after('<span class="cf7sg-validation-warning">Value cannot be zero</span>'),a.val(i),s=!0;break;case 0>a.val()&&a.is(".sgv-no-negative"):a.after('<span class="cf7sg-validation-warning">Value cannot be negative</span>'),a.val(i),s=!0;break;case""==a.val()&&a.hasClass("sgv-not-empty"):a.after('<span class="cf7sg-validation-warning">Value cannot be empty</span>'),a.val(i),s=!0}s&&a.next("span.cf7sg-validation-warning").delay(3e3).fadeOut("slow").remove()}}));var s=t("div.cf7-smart-grid.has-tabs form.wpcf7-form");s.length&&(i={},t(".cf7-sg-tabs",s).each(function(){var e=t(this);e.tabs();var a=e.children(".cf7-sg-tabs-list");if(1==a.children("li").length){a.after('<ul class="cf7sg-add-tab ui-tabs-nav"><li class="ui-state-default ui-corner-top"><a class="cf7sg-add-tab ui-tabs-anchor"><span class="cf7sg-add-tab dashicons dashicons-plus"></span></a></li></ul>');var s=e.children(".cf7-sg-tabs-panel").first(),n=t('<input class="cf7sg-tracker-field" value="1" type="hidden">').attr("name",s.attr("id"));e.prepend(n),s.find(":input").each(function(){var e=t(this);if(!e.is(".cf7-sg-table :input")){var a=e.attr("name");a.length>0&&e.addClass("cf7sg-"+a.replace("[]",""))}});var c=t("<div>").append(s.clone());t(":input",c).prop("disabled",!0),i[s.attr("id")]=c.html()}}),s.trigger("sgTabsReady"),s.click("ul.ui-tabs-nav li",function(e){var a=t(e.target),i=a.closest(".cf7-sg-tabs");if(a.is(".cf7sg-close-tab")){var s=a.siblings("a").attr("href"),n=!1;i.children("div"+s).remove(),a.closest("li").remove().is(".ui-state-active")&&(n=!0);var c=i.find(".cf7-sg-tabs-list li:last-child .cf7sg-close-tab");c.length>0&&c.show(),n&&i.tabs({active:0});var r=i.children(".cf7sg-tracker-field");r&&r.val(i.children(".cf7-sg-tabs-panel").length)}else a.is(".cf7sg-add-tab")&&i.cf7sgCloneTab()}));var n=t("div.cf7-smart-grid.has-nice-select form.wpcf7-form");n.length>0&&(n.filter("div.cf7_2_post form.wpcf7-form").each(function(){var e=t(this),a=e.closest("div.cf7_2_post").attr("id");a.length>0&&e.on(a,function(e){var a=t(this);t(".cf7sg-dynamic-dropdown.ui-select:enabled",a).each(function(){t(this).niceSelect()}),t(".wpcf7-form-control.nice-select:enabled",a).each(function(){t(this).niceSelect()}),a.trigger("sgNiceSelect")})}),n.not("div.cf7_2_post form.wpcf7-form").each(function(){var e=t(this);t(".cf7sg-dynamic-dropdown.ui-select:enabled",e).each(function(){t(this).niceSelect()}),t(".wpcf7-form-control.nice-select:enabled",e).each(function(){t(this).niceSelect()}),e.trigger("sgNiceSelect")}));var c=t("div.cf7-smart-grid.has-select2 form.wpcf7-form");c.length>0&&(c.filter("div.cf7_2_post form.wpcf7-form").each(function(){var e=t(this),a=e.closest("div.cf7_2_post").attr("id");a.length>0&&e.on(a,function(e){var a=t(this);t("select.wpcf7-form-control.select2:enabled",a).each(function(){var e=t(this);e.select2({tags:e.is(".tags")})}),a.trigger("sgSelect2")})}),c.not("div.cf7_2_post form.wpcf7-form").each(function(){var e=t(this);t("select.wpcf7-form-control.select2:enabled",e).each(function(){var e=t(this);e.select2({tags:e.is(".tags")})}),e.trigger("sgSelect2")}));var r=document.createElement("input");r.setAttribute("type","date");var o="date"==r.type,l=t("div.cf7-smart-grid.has-date form.wpcf7-form");l.length>0&&(l.filter("div.cf7_2_post form.wpcf7-form").each(function(){var e=t(this),a=e.closest("div.cf7_2_post").attr("id");a.length>0&&e.on(a,function(e){t("input.wpcf7-date:enabled",t(this)).each(function(){var e=t(this),a=e.attr("id");void 0===a&&(a=d(6),e.attr("id",a)),o||e.setupDatePicker()})})}),l.not("div.cf7_2_post form.wpcf7-form").each(function(){t("input.wpcf7-date:enabled",t(this)).each(function(){var e=t(this),a=e.attr("id");void 0===a&&(a=d(6),e.attr("id",a)),o||e.setupDatePicker()})}));var f=t("div.cf7-smart-grid.has-accordion form.wpcf7-form");function d(t){t||(t=5);for(var e="",a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",i=0;i<t;i++)e+=a.charAt(Math.floor(Math.random()*a.length));return e}f.length>0&&(f.filter("div.has-toggles form.wpcf7-form").each(function(){var e=t(this),a=t(".cf7sg-collapsible.with-toggle",e);a.each(function(){var a=t(this),i=a.attr("id");void 0===i&&(i=d(6),a.attr("id",i));var s=a.data("open"),n=!1;if(void 0===s)s=!1;else switch(s){case!0:s=0,n=!0}0==e.closest("div.cf7_2_post").length&&(n||t(":input",t(this).children(".row")).prop("disabled",!0)),a.children(".cf7sg-collapsible-title").children(".toggle").setupToggle(n),t("#"+i).accordion({collapsible:!0,icons:!1,active:s,header:"> div.cf7sg-collapsible-title",heightStyle:"content",activate:function(e,a){t(this).trigger("sgContentIncrease")}})}),a.on("sgContentIncrease",function(){t(this).accordion("refresh")}),e.click(a,function(a){var i,s=t(a.target);if(s.is("span.cf7sg-title.toggled")||s.is(".toggle-on")||s.is(".toggle-off"))i=s.closest(".cf7sg-collapsible-title");else{if(!s.parent().is(".cf7sg-collapsible.with-toggle"))return;i=s}var n=i.closest(".container.cf7sg-collapsible").attr("id"),c="",r=t('input[name="_cf7sg_toggles"]',t(this)),o=!1;void 0!==n&&r.length>0&&(c=r.val().length>0?JSON.parse(r.val()):{},o=!0);var l=i.parent().data("group");l&&t('.cf7sg-collapsible.with-toggle[data-group="'+l+'"]',e).each(function(){var e=t(this),a=e.attr("id");n!==a&&0===e.accordion("option","active")&&(e.accordion("option","active",!1),t(".toggle",e).data("toggles").toggle(!1),t(".row.ui-accordion-content :input",e).prop("disabled",!0),o&&c.hasOwnProperty(a)&&delete c[a])});var f=i.children(".toggle").data("toggles");if(i.hasClass("ui-state-active")){if(f.toggle(!0),t(".row.ui-accordion-content :input",i.parent()).not(".cf7-sg-cloned-table-row :input").prop("disabled",!1),o){var d=i.clone();d.children(".toggle").remove(),c[n]=d.text().trim()+"|"+i.children(".toggle").data("on")}}else f.toggle(!1),t(".row.ui-accordion-content :input",i.parent()).each(function(){var e=this.value;t(this).val(e.trim()).prop("disabled",!0)}),o&&c.hasOwnProperty(n)&&delete c[n];void 0!==n&&r.length>0&&r.val(JSON.stringify(c))})}),f.each(function(){t(".cf7sg-collapsible",t(this)).not(".cf7sg-collapsible.with-toggle").each(function(){var e=t(this),a=e.attr("id");void 0===a&&(a=d(6),e.attr("id",a));var i=e.data("open");if(void 0===i)i=!1;else switch(i){case!0:i=0}t("#"+a).accordion({collapsible:!0,active:i,heightStyle:"content",header:"> div.cf7sg-collapsible-title",activate:function(e,a){t(this).trigger("sgContentIncrease")}}),e.on("sgContentIncrease",function(){t(this).accordion("refresh")})})}),f.trigger("sgCollapsibleRowsReady")),t("div.cf7_2_post div.cf7-smart-grid.has-toggles form.wpcf7-form").each(function(){var e=t(this),a=e.closest("div.cf7_2_post").attr("id");a.length>0&&e.on(a,function(e){t(".cf7sg-collapsible.with-toggle",t(this)).each(function(){var e=t(this),a=e.attr("id");void 0===cf7sg.toggles_status||void 0===cf7sg.toggles_status[a]?t(".row.ui-accordion-content :input",e).prop("disabled",!0):e.children(".cf7sg-collapsible-title").trigger("click")})})}),t("div.cf7-smart-grid form.wpcf7-form").trigger("cf7SmartGridReady"),t("div.cf7-smart-grid").on("wpcf7:invalid",".wpcf7",function(e,a){t(e.target);for(var i in a.inputs){var s=a.inputs[i].name,n=t(':input[name="'+s+'"]').closest(".cf7sg-collapsible");n.length>0&&n.accordion("option","active",0)}}),t("div.cf7-smart-grid .wpcf7-submit").after('<span class="cf7sg-popup display-none">'+cf7sg.submit_disabled+"</span>").parent().addClass("cf7sg-popup"),t("div.cf7-smart-grid").on("sgRowAdded",".container.cf7-sg-table",function(e,a){var i,s,n=t(this);if(void 0===(i=n.data("max"))||0==i)return!1;--i==a&&(s='<span class="max-limit wpcf7-not-valid-tip">'+cf7sg.max_table_rows+"</span>",n.next(".cf7-sg-table-button").addClass("disabled").prepend(s))}),t("div.cf7-smart-grid").on("sgRowDeleted",".container.cf7-sg-table",function(e){var a,i=t(this);if(void 0===(a=i.data("max"))||0==a)return!1;i.next(".cf7-sg-table-button").removeClass("disabled").children(".max-limit").remove()})}),t.fn.setupDatePicker=function(){var e=t(this);if(!e.is(".wpcf7-date:enabled"))return e;var a="",i="",s=e.attr("min");void 0===s?s=null:a=(s=new Date(s)).getFullYear();var n=e.attr("max");return void 0===n?n=null:i=(n=new Date(n)).getFullYear(),e.datepicker("destroy"),e.datepicker({defaultDate:e.val(),dateFormat:"yy-mm-dd",minDate:s,maxDate:n,changeMonth:!0,changeYear:!0}),a>0&&i>0?e.datepicker("option","yearRange",a+":"+i):a>0?e.datepicker("option","yearRange",a+":c+20"):i>0&&e.datepicker("option","yearRange","c-20:"+i),e},t.fn.cf7sgCloneRow=function(e){void 0===e&&(e=!0);var a=t(this),i="";if(a.is(".cf7-sg-table-footer")&&(i=a,a=a.closest(".container.cf7-sg-table")),!a.is(".container.cf7-sg-table"))return a;var s=a.children(".row.cf7-sg-table").length-1,n=t(".cf7-sg-cloned-table-row",a),c=n.clone();c.removeClass("cf7-sg-cloned-table-row").attr("data-row",s),i.length>0?i.before(c.show()):n.before(c.show()),String.prototype.endsWith||(String.prototype.endsWith=function(t,e){var a=this.toString();("number"!=typeof e||!isFinite(e)||Math.floor(e)!==e||e>a.length)&&(e=a.length),e-=t.length;var i=a.indexOf(t,e);return-1!==i&&i===e}),t(":input",c).each(function(){var a=t(this);a.prop("disabled",!1);var i=a.attr("name"),n="";i.endsWith("[]")&&(i=i.replace("[]",""),n="[]"),a.attr("name",i+"_row-"+s+n),a.closest("span.wpcf7-form-control-wrap").removeClass(i).addClass(i+"_row-"+s),a.is("select.ui-select")&&e&&a.niceSelect(),a.is("select.nice-select")&&e&&a.niceSelect(),a.is("select.select2")&&e&&(a.select2({tags:a.is(".tags")}),a.trigger("sgSelect2"))}),a.trigger("sgContentIncrease"),a.trigger("sgRowAdded",s);var r=a.children(".cf7sg-tracker-field");return r.length&&r.val(s+1),a},t.fn.cf7sgCloneTab=function(e){var a=t(this);if(void 0===e&&(e=!0),!a.is("div.cf7-sg-tabs"))return a;var s=a.children(".cf7-sg-tabs-list"),n=s.children("li").length+1,c=a.children(".cf7-sg-tabs-panel").first().attr("id"),r=c+"-"+n,o=s.children("li").first().clone();o.find("a").attr("href","#"+r).text(o.text()+" ("+n+")"),o.append('<span class="cf7sg-close-tab dashicons dashicons-no-alt"></span>'),o.removeClass("ui-tabs-active ui-state-active"),s.find("li .cf7sg-close-tab").hide(),s.append(o);var l=t(i[c]);l.attr("id",r),t(":input",l).each(function(){var a=t(this),i=a.is(".cf7-sg-cloned-table-row :input");i||a.prop("disabled",!1);var s=a.attr("name"),c="";s.endsWith("[]")&&(s=s.replace("[]",""),c="[]"),a.attr("name",s+"_tab-"+(n-1)+c),a.closest("span.wpcf7-form-control-wrap").removeClass(s).addClass(s+"_tab-"+(n-1)),!i&&a.is("select.ui-select")&&e&&a.niceSelect(),!i&&a.is("select.nice-select")&&e&&a.niceSelect(),!i&&a.is("select.select2")&&e&&(a.select2({tags:a.is(".tags")}),a.trigger("sgSelect2"))}),a.append(l),l.find("ul.ui-tabs-nav li a").each(function(){var e=t(this);r=e.attr("href"),e.attr("href",r+"-"+n),e.closest("ul.ui-tabs-nav").siblings("div"+r).attr("id",r.substring(1)+"-"+n)}),t(".cf7-sg-tabs",l).each(function(){t(this).tabs()}),t(".cf7sg-collapsible.with-toggle",l).each(function(){var a=t(this),i=a.attr("id")+"_tab-"+(n-1);a.attr("id",i);var s=a.data("group");s&&(s=s+"_tab-"+(n-1),a.attr("data-group",s));var c=a.data("open"),r=!1;if(void 0===c)c=!1;else switch(c){case!0:c=0,r=!0}t(".toggle",a).setupToggle(r),t(".cf7sg-collapsible",l).accordion({collapsible:!0,icons:!1,active:c,header:"> div.cf7sg-collapsible-title",heightStyle:"content",activate:function(e,a){t(this).trigger("sgContentIncrease")}}),!r&&e&&t(".row.ui-accordion-content :input",a).prop("disabled",!0)}),a.tabs("refresh"),a.tabs("option","active",-1),l.trigger("sgTabAdded",n);var f=a.children(".cf7sg-tracker-field");return f&&f.val(a.children(".cf7-sg-tabs-panel").length),a},t.fn.setupToggle=function(e){var a=t(this);if(void 0===e&&(e=!1),!a.is(".toggle"))return a;if(a.length>0){var i=a.data("on");0==i.length&&(i="Yes");var s=a.data("off");0==i.length&&(s="No"),a.toggles({drag:!1,text:{on:i,off:s},on:e})}return a},t("div.cf7-smart-grid.has-update form.wpcf7-form").on("cf7SmartGridReady",function(){var i=t(this);t.ajax({type:"POST",url:cf7sg.url,dataType:"json",data:{action:"save_grid_fields",nonce:t('input[name="_wpnonce"]',i).val(),tabs_fields:JSON.stringify(e),table_fields:JSON.stringify(a),id:t('input[name="_wpcf7"]',i).val()}}).fail(function(t,e){console.log("CF7 Smart Grid ERROR sending grid fields to server: "+e)})})}(jQuery);
